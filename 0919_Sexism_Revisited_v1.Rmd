---
title: "Sexism Revisited Or Why Our Kids Should Listen To Jazz"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Parenting in the twenty-first century is not an easy endeavor. Yet, the values we teach our children are core to a sustainable and just future. Today, the idea of gender equality is heavily fostered by parents around the globe. Some parents seem more successful in doings so than others. It seems that our everyday environment has a big effect.

![](../figs/explicit-music.jpg)

Many of us take very good care with whom our children play or what movies they watch. When it comes to music, however, one of the few paradigms seems to be that Hip-Hop music is detrimental to our kids' growing value sets. We often connect Hip-Hop with explicit sexism. And this might be justified. But what about other genres: How are women portrayed in Jazz, Pop, or Metal? And in which genre are songs about women most positive?

This data story is a journey through the traces of implicit sexism in our everyday (music) life. You will learn which genre might be best for your kids and whether the music you are listening to while driving your kids to school is as progressive as it sounds.

### Are songs from certain genres talking more negative about women than others?

Let's give it a start. In the following bar plot we see that there certainly is a big difference in songs about women between various genres:

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Load relevant libraries 
library(tidytext)
library(ggplot2)
library(tm)
library(wordcloud)
library(wordcloud2)
library(plyr)
library(dplyr)
library(stringr)
library(SentimentAnalysis)
library(topicmodels)
library(lda)
library(RColorBrewer)
library(imager)
library(tidyr)


# The pre-processing was done along the the starter code given to us. There is one 
# exception though: I did excluded female and male third person singular pronouns 
# from the stop words. Like this I can later look at which songs are talking heavily
# about women (and men). The pre-processing can be retraced in a separate doc in 
# this folder.

load('../output/processed_lyrics_gender.RData') 
lyrics_gender <- dt_lyrics


#### In this step I identify songs that are most about women across all genres

# Put frequencies of "she", etc. from the lyrics in new column.
# Usually names in songs are not mentioned, that's why I use pronouns as 
# identifiers for songs about women
keywords_w <- c(" she ", " her ", " shed ", " shell ", " shes ", " hers ")
keywords_temp <- paste(keywords_w, collapse = '|', sep = '')
lyrics_gender$freq_w <- str_count(lyrics_gender$stemmedwords, keywords_temp) + 1

keywords_m <- c(" he ", " him ", " hed ", " hell ", " hes ", " his ")
keywords_temp <- paste(keywords_m, collapse = '|', sep = '')
lyrics_gender$freq_m <- str_count(lyrics_gender$stemmedwords, keywords_temp) + 1

# Create new column for genre per year 
lyrics_gender <- lyrics_gender %>% mutate(genre_year = paste(genre, year, sep = '_'))

# Remove "she", etc. from the stemmed words
stop_words <- paste(c(keywords_w, keywords_m), collapse = '|', sep = '')
lyrics_gender$stemmedwords <- gsub(stop_words, ' ', lyrics_gender$stemmedwords)
lyrics_gender$stemmedwords <- gsub('  ', ' ', lyrics_gender$stemmedwords)

# Select the 15,000 songs talking about women (and men) most intense

women_songs <- lyrics_gender[order(lyrics_gender$freq_w, decreasing = TRUE),] %>%
  slice(., 1:15000)

men_songs <- lyrics_gender[order(lyrics_gender$freq_m, decreasing = TRUE),] %>%
  slice(., 1:15000)


#### Now I want to know the sentiments present in the songs per genre

# Write function to get sentiments per genre
sentiment_genre <- function(x, y){
  
  text_genre <- filter(x, genre == y)
  sentiment_women_genre <- analyzeSentiment(text_genre$stemmedwords)
  
  sentiment_genre <- convertToBinaryResponse(sentiment_women_genre) %>% 
    select(., SentimentGI)
  
  result <- table(sentiment_genre)
  return(result)
}

#sentiment_genre(women_songs, 'Pop')
#sentiment_genre(women_songs, 'Hip-Hop')

# Create dataframe with sentiment results per genre based on function
genres <- c('Country', 'Electronic', 'Folk', 'Hip-Hop', 'Indie', 'Jazz', 'Metal', 
            'Pop', 'R&B', 'Rock')
sentiments <- data.frame(stringsAsFactors = F)

for(i in genres){
  result <- sentiment_genre(women_songs, i) %>% as.data.frame() %>% mutate(genre = i)
  sentiments <- rbind.fill(sentiments, result)
}

sentiments_w <- sentiments %>% group_by(genre) %>% mutate(sum = sum(Freq)) %>%
  mutate(share = Freq / sum) %>% subset(., sentiment_genre=='negative')

# Visualize results
ggplot() +
  geom_bar(data = sentiments_w, aes(x = reorder(genre, -share), y = share), 
           stat = 'identity', fill = "blue1") + 
  theme(legend.position = "none") +
  labs(x = "Genre", y = "Share of negative sentiments", 
       title = "Negative sentiments in songs about women")

```

To Metal fans, the results might be breathtaking. The plot clearly shows that Metal as well as Hip-Hop songs about women are by far the songs with the highest shares of negative sentiments. Jazz and Folk songs, however, seem to talk the most positive about women. 

### A positive note: What makes Jazz songs about women so nice?

The word cloud with dominant terms in Jazz songs about women is full of "love". Probably, this does not come surprisingly to you since many songs we know are about love. 

However, some of you might argue that certain dominant terms here could even be perceived as sexist. It should be noted though that this word cloud gives an overall positive impression.

```{r echo=FALSE, message=FALSE, warning=FALSE}

#### Here, I want to visualize dominant words of a respective genre

# Write function to get wordcloud from most frequent words
lyrics_shape <- function(x, y){
  
  songs <- filter(x, genre == y)
  
  corpus <- Corpus(VectorSource(songs$stemmedwords))
  m <- as.matrix(TermDocumentMatrix(corpus))
  v <- sort(rowSums(m), decreasing = TRUE)
  d <- data.frame(word = names(v), freq = v)
  
  return(wordcloud2(d, color = "random-dark"))
}

lyrics_shape(women_songs, "Jazz")

```

### And what makes makes Metal songs about women so negative?

Despite the fact that also "love" seems to be a dominant element in Metal songs, we can find much darker words such as "black", "blood", or "burn". And death itself seems to be a very prominent pattern... 

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Apply previously defined function again
lyrics_shape(women_songs, "Metal")

```

### Let's take a look at Hip-Hop: What are the relevant topics there?

Well, it's commonly known that Hip-Hop portrays women in a negative way. The graph below gives us insights into potential topics of songs about women. We clearly see that the topics of Hip-Hop songs about women are interestingly about love to women, about money and showing-off, as well as about a very negative view on women.

```{r echo=FALSE, message=FALSE, warning=FALSE}

#### Now, I want to model the topics of a respective genre

# Write a function to get topics of a genre
topics_genre <- function(x, y){
  
  text_genre <- filter(x, genre == y)
  
  corpus <- Corpus(VectorSource(text_genre$stemmedwords))
  genre_dtm <- DocumentTermMatrix(corpus)
  
  genre_lda <- LDA(genre_dtm, 3)
  genre_topics <- tidy(genre_lda, matrix = "beta")
  genre_topics
  
  genre_terms <- genre_topics %>%
    group_by(topic) %>%
    top_n(20, beta) %>%
    ungroup() %>%
    arrange(topic, -beta)
  
  result <- genre_terms %>%
    mutate(term = reorder_within(term, beta, topic)) %>%
    ggplot(aes(term, beta, fill = factor(topic))) +
    geom_col(show.legend = FALSE) +
    facet_wrap(~ topic, scales = "free") +
    coord_flip() +
    scale_x_reordered() +
    labs(x = "Term", y = "Beta value", 
       title = "Modeled topics for Hip-Hop songs about women")
  
  print(result)
}

topics_genre(women_songs, 'Hip-Hop') 

```

### Finally: Where are we heading?

So far, we have looked at quite some genres and their characters. You might wonder: Is there a special development over time? Did - as awareness about sexism increased - songs become less negative when talking about women? Here is the result for Hip-Hop, Jazz, and Metal for the development over the last ten years that data was available:

```{r echo=FALSE, message=FALSE, warning=FALSE}

#### Finally, I want to look at the development in specific genres over time

# Create function for sentiment of genre in a specific year
sentiment_genre_years <- function(x, y){
  
  text_genre <- filter(x, genre_year == y)
  sentiment_text_genre <- analyzeSentiment(text_genre$stemmedwords)
  
  sentiment_genre <- convertToBinaryResponse(sentiment_text_genre) %>% select(., SentimentGI)
  
  result <- table(sentiment_genre)
  return(result)
}

# Select songs from 1990 on and create dataframe with aggregated results
women_songs_1990 <- women_songs %>% filter(year >= 2000 & 
                                             genre != 'Not Available')

genres <- unique(women_songs_1990$genre_year)

sentiments <- data.frame(stringsAsFactors = F)

for(i in genres){
  result <- sentiment_genre_years(women_songs_1990, i) %>% as.data.frame() %>% mutate(genre = i)
  sentiments <- rbind.fill(sentiments, result)
}


sentiments_w <- sentiments %>% group_by(genre) %>% mutate(sum = sum(Freq)) %>%
  mutate(share = Freq / sum) %>% subset(., sentiment_genre=='negative') %>%
  rename(genre_year = genre) %>% separate(., genre_year, into = c('genre', 'year'), sep = "_") %>%
  mutate(year = as.numeric(year)) %>% arrange(year)

# Visualize Hip-Hop, Jazz, and Metal genre from 2006 to 2016
sentiments_final <- sentiments_w %>% filter(year > 2005) %>%
  filter(genre %in% c("Metal", "Hip-Hop", "Jazz"))

ggplot() +
  geom_line(data = sentiments_final, aes(x = year, y = share, color = genre), size = 1, 
            stat = 'identity') +
  theme_minimal() +
  labs(x = "Time", y = "Share of negative sentiments", 
       title = "Negative sentiments in songs about women over time")

```

The good news is: the share of negative sentiments in Metal and Hip-Hop songs about women remained fairly constant over time. The bad news is: it also did not improve! If we look at these results, what else should we suggest our kids to listen to other than Jazz? 

Or maybe they should rather make Jazz music themselves...

![](../figs/kids-jazz.jpg)

